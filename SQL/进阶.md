# 存储引擎
![[Pasted image 20251224105500.png]]
索引是在存储引擎层实现的，所以不同存储引擎它的存储结构是不同的。

![[Pasted image 20251224105528.png]]
存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式。==存储引擎是基于表的，而不是基于库的，所以存储引擎也可被称为表类型。==
![[Pasted image 20251224110344.png]]
  ![[Pasted image 20251224110521.png]]
  ![[Pasted image 20251224110830.png]]
# 索引
![[Pasted image 20251224141514.png]]
![[Pasted image 20251224141534.png]]
![[Pasted image 20251224142555.png]]
![[Pasted image 20251224142722.png]]
![[Pasted image 20251224143346.png]]
## 性能分析
![[Pasted image 20251224144121.png]]
这里Com后面的下划线数量是7个。
![[Pasted image 20251224144810.png]]
![[Pasted image 20251224145024.png]]
![[Pasted image 20251224150353.png]]
![[Pasted image 20251224151233.png]]
![[Pasted image 20251224151337.png]]
## 使用规则
  ![[Pasted image 20251224153505.png]]
  只要在查询联合索引时，最左前缀的字段有出现（无论位置先后），则不影响使用联合索引。
  **范围查询**：联合索引中，出现范围查询(>,<)，==范围查询右侧的列索引失效==
  ![[Pasted image 20251224154339.png]]
  ![[Pasted image 20251224154507.png]]
  ![[Pasted image 20251224154532.png]]
  ![[Pasted image 20251224154855.png]]
  ![[Pasted image 20251224155251.png]]
  ![[Pasted image 20251224155632.png]]
  ![[Pasted image 20251224160444.png]]
  ![[Pasted image 20251224160454.png]]
  ![[Pasted image 20251224161147.png]]
## 设计原则
![[Pasted image 20251224162836.png]]
# SQL优化
## 插入数据
![[Pasted image 20251224170246.png]]
![[Pasted image 20251224170458.png]]
==主键顺序插入性能高于乱序插入==
## 主键优化
**数据组织方式**：在InnoDB存储引擎中，表数据都是根据主键顺序组织存放的，这种存储方式的表称为==索引组织表==(index organized table ==IOT==)。
  ![[Pasted image 20251224171645.png]]
## order by优化
![[Pasted image 20251224172328.png]]
如果一个进行升序排序，另一个进行降序排序，这时候会出现Using filesort情况，效率较低，需要再创建对应排序的索引。（如下图所示）
![[Pasted image 20251224172650.png]]
![[Pasted image 20251224172752.png]]
## group by优化
![[Pasted image 20251224173208.png]]
## limit优化
![[Pasted image 20251224173611.png]]
## count优化
![[Pasted image 20251224180039.png]]
![[Pasted image 20251224180250.png]]
## update优化
==InnoDB的行锁是针对索引加的锁，不是针对记录加的锁,并且该索引不能失效，否则会从行锁升级为表锁==
## 总结
![[Pasted image 20251224181136.png]]
# 视图
![[Pasted image 20251226161156.png]]
![[Pasted image 20251226162022.png]]
在有关联的视图中会从加了==“with cascaded check option”==的视图开始检查，如上图所示，若插入的数据id为17，可以成功插入。理由如下：虽然v3的条件是id<=15，但是并未添加“with cascaded check option”选项，所以不会进行检查。但v3的基表v2有该选项，所以会对v2及其依赖的视图v1进行检查，id = 17满足插入v2和v1的条件，故插入成功。
**现有疑问：若v1并未添加“with cascaded check option”选项且有依赖的视图，那么在插入数据时是否还会检查v1所依赖视图的条件？** 

**回答：会，因为cascaded 会检查依赖的==所有==视图，==并且就算依赖的视图没有check option选项也会进行检查（待验证）==**

对于==local==，如果v2添加了local选项，而v1并没有添加检查选项，则对v2插入数据时，仅仅会检查v2的条件，而不会检查v1。
**local总结**：local只将自身进行捆绑，检查自身数据，不会强制依赖的视图进行检查（若依赖的视图有检查选项就检查，反之不检查）。

![[Pasted image 20251226165824.png]]
![[Pasted image 20251226165951.png]]
# 存储过程
![[Pasted image 20251226202950.png]]
![[Pasted image 20251226203242.png]]
![[Pasted image 20251226203634.png]]
![[Pasted image 20251226204248.png]]

![[Pasted image 20251226204650.png]]
==注意：用户定义的变量无需对其进行声明或初始化，只不过获取到的值为NULL。==

![[Pasted image 20251226205016.png]]
![[Pasted image 20251226205210.png]]
![[Pasted image 20251226205603.png]]
![[Pasted image 20251226205920.png]]
![[Pasted image 20251226210107.png]]
![[Pasted image 20251226210158.png]]
![[Pasted image 20251226210708.png]]
![[Pasted image 20251226210946.png]]
![[Pasted image 20251226211822.png]]
# 存储函数
![[Pasted image 20251226212324.png]]
# 触发器
![[Pasted image 20251226212729.png]]
**行级触发器**： 若执行update语句，影响了5行，则触发器会被触发5次。
**语句级触发器** ：若执行update语句，不管影响多少行，只触发1次。

![[Pasted image 20251226213124.png]]
# 锁
## 全局锁
![[Pasted image 20251227223045.png]]
## 表级锁
![[Pasted image 20251227223559.png]]
==绿色代表可行操作，红色代表不可行操作==

![[Pasted image 20251227223839.png]]
**查看==元数据锁==:**
select object_type,object_schema,object_name,lock_type,lock_duration from performance_ schema.==metadata_locks== ;

![[Pasted image 20251227224740.png]]
![[Pasted image 20251227224908.png]]
![[Pasted image 20251227225020.png]]
**可以通过以下SOL，查看==意向锁及行锁==的加锁情况:**
select object_schema,object_name,index_name,lock_type,lock_mode,ock_data from performance_schema.==data_locks==;

## 行级锁
![[Pasted image 20251227230613.png]]
![[Pasted image 20251227230757.png]]
![[Pasted image 20251227230852.png]]
![[Pasted image 20251227231358.png]]

![[Pasted image 20251227231843.png]]

# InnoDB引擎
## 逻辑存储结构
![[Pasted image 20251228173553.png]]
## 架构
![[Pasted image 20251228175448.png]]
**- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -**
![[Pasted image 20251228175502.png]]
**- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -**
![[Pasted image 20251228175521.png]]
**- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -**
![[Pasted image 20251228175631.png]]
![[Pasted image 20251228175659.png]]



**——————————————————————————————————**



![[Pasted image 20251228174925.png]]
![[Pasted image 20251228174934.png]]
![[Pasted image 20251228175209.png]]



**——————————————————————————————————**



![[Pasted image 20251228192913.png]]
![[Pasted image 20251228192926.png]]
## 事务原理
![[Pasted image 20251228193142.png]]
![[Pasted image 20251228193615.png]]
![[Pasted image 20251228193813.png]]


## MVCC
![[Pasted image 20251228194220.png]]



**——————————————————————————————————**



![[Pasted image 20251228194707.png]]

**- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -**

![[Pasted image 20251228194911.png]]

**- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -**

![[Pasted image 20251228195320.png]]
![[Pasted image 20251228195350.png]]
不同事务或相同事务对同一条记录进行修改，会导致该记录的undolog生成一条记录版本链表，链表的头部是最新的旧记录，链表尾部是最早的旧记录。

**- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -**

![[Pasted image 20251228195630.png]]
![[Pasted image 20251228200145.png]]

**- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -**

![[Pasted image 20251228201328.png]]
# MySQL管理
## 系统数据库
![[Pasted image 20251228201901.png]]
## 常用工具
 ![[Pasted image 20251228202001.png]]

**——————————————————————————————————**

![[Pasted image 20251228202447.png]] 

**——————————————————————————————————**

![[Pasted image 20251228202732.png]]

**——————————————————————————————————**

![[Pasted image 20251228202947.png]]

**——————————————————————————————————**

![[Pasted image 20251228203623.png]]
